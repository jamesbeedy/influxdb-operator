# Copyright (c) 2025 Vantage Compute Corporation
# See LICENSE file for licensing details.
name: influxdb
summary: |
  Influxdb operator charm.

description: |
  This charm provides influxdb.

links:
  contact: https://matrix.to/#/#hpc:ubuntu.com

  issues:
    - https://github.com/charmed-hpc/slurm-charms/issues

  source:
    - https://github.com/charmed-hpc/slurm-charms

assumes:
- juju

type: charm
platforms:
  ubuntu@24.04:amd64:

parts:
  influxdb:
    source: .
    plugin: uv
    build-snaps:
      - astral-uv
  # Create a version file and pack it into the charm. This is dynamically generated
  # as part of the build process for a charm to ensure that the git revision of the
  # charm is always recorded in this version file.
  version-file:
    plugin: nil
    build-packages:
      - git
    override-build: |
      VERSION=$(git -C $CRAFT_PART_SRC/../../apptainer/src describe --always)
      echo "Setting version to $VERSION"
      echo $VERSION > $CRAFT_PART_INSTALL/version
    stage:
      - version
